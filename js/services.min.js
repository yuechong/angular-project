services.factory("tools",["$http","$rootScope","$timeout","$q",function(e,t,n,o){return{$post:function(t){if(!(!t instanceof Object)&&t.url){var n=this,i=o.defer();return e({method:"post",url:t.url,data:t.data,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}}).success(function(e){return"session expired"==e.value||"session expired"==e.message||e.message&&e.message.indexOf("Account is logged in by other people")!=-1?void(n.mobileEnv()?window.location.href="/trend-new-BI/mobileMain.html":window.location.href="/trend-new-BI/main.html"):void(e.success?i.resolve(e):i.reject(e))}).error(function(e){i.reject(e)}),i.promise}},$get:function(n){if(!(!n instanceof Object)&&n.url){var i=this,r=o.defer();return e({method:"GET",url:n.url,params:n.data||{},headers:{Accept:"application/json, text/javascript, */*"}}).success(function(e){t.$broadcast("loading_off"),("session expired"==e.value||"session expired"==e.message||e.message&&e.message.indexOf("Account is logged in by other people")!=-1)&&(i.mobileEnv()?window.location.href="/trend-new-BI/mobileMain.html":window.location.href="/trend-new-BI/main.html"),e.success?r.resolve(e):r.reject(e)}).error(function(e){r.reject(e)}),r.promise}},get:function(n){var o=this;!n instanceof Object||!n.url||(t.$broadcast("loading"),e({method:n.method||"GET",url:n.url,params:n.data||{},headers:{Accept:"application/json, text/javascript, */*"}}).success(function(e){t.$broadcast("loading_off"),("session expired"==e.value||"session expired"==e.message||e.message&&e.message.indexOf("Account is logged in by other people")!=-1)&&(o.mobileEnv()?window.location.href="/trend-new-BI/mobileMain.html":window.location.href="/trend-new-BI/main.html"),n.succ&&n.succ(e)}).error(function(e){t.$broadcast("loading_off"),n.fail&&n.fail(e)}))},post:function(t){var n=this;!t instanceof Object||!t.url||e({method:"post",url:t.url,data:t.data,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}}).success(function(e){"session expired"!=e.value&&"session expired"!=e.message&&e.message.indexOf("Account is logged in by other people")==-1||(n.mobileEnv()?window.location.href="/trend-new-BI/mobileMain.html":window.location.href="/trend-new-BI/main.html"),t.succ&&t.succ(e)})},trim:function(e){if(!e instanceof String)return e;var t=e.replace(/^\s+|\s+$/gi,"");return t},alert:function(e,n){return t.$broadcast("alert",e,n),!1},confirm:function(e){return e?void t.$broadcast("CONFIRM_EV",e):void t.$broadcast("CONFIRM_OFF_EV")},msg:function(e){t.$broadcast("MESSAGE_EV",e)},isEmpty:function(e){for(var t in e)return!1;return!0},data:{data:{itemlist:{checkboxlist:{},chartlist:{},radiolist:{},betweenlist:{},selectlist:{},datelist:{},sheetlist:{},notelist:{},syncdatalist:{}}},setItem:function(e,t){this.data[e]=t},getItem:function(e){return this.data[e]},delItem:function(e){delete this.data[e]}},identifier:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=0;n<20;n++)e+=t[Math.floor(25*Math.random())];return e},makeConditionId:function(){for(var e="",t="0123456789",n=0;n<20;n++)e+=t[Math.ceil(9*Math.random())];return e},tmpId:function(){for(var e="",t="0123456789",n=0;n<20;n++)e+=t[Math.ceil(9*Math.random())];return Number(e)},fieldId:function(){return Math.floor(Math.random()*Math.random()*1e10)},isPreviewing:function(){return window.location.hash.indexOf("system")!=-1},isEditing:function(){return window.location.hash.indexOf("editor")!=-1},storage:{setItem:function(e,t){window.localStorage.setItem(e,t)},getItem:function(e){return window.localStorage.getItem(e)},removeItem:function(e){window.localStorage.removeItem(e)}},gridwidth:function(){return Math.floor(.95*window.screen.width/80)},dragcontentwidth:function(){return 80*Math.floor(.95*window.screen.width/80)},screenCapture:function(){html2canvas(document.body).then(function(e){$(".imgsrc").val(e.toDataURL())})},jsonToQueryStr:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")},img2base64:function(e){var t=document.createElement("canvas");t.width=250,t.height=250;var n=t.getContext("2d"),o=new Image;o.src=e,n.drawImage(o,0,0);var i=t.toDataURL();console.log(i)},userConfig:null,updateUserConfig:function(e){var t=this;if(t.userConfig){var n=JSON.stringify(t.userConfig).replace(/:null/gi,':""');this.get({url:"/Ibm-Client/updateUserConfig.htm",data:{configInfo:n},succ:function(t){t.success&&e&&e()}})}},getUserConfig:function(){return this.userConfig},initUserConfig:function(e){this.userConfig=e.userConfig||{},this.userInfo=e},refresh:function(){n(function(){},0)},mobileEnv:function(){return window.location.href.indexOf("mobileMain")!=-1},isJiaguwen:function(){return"app315.trenddata.cn"==window.location.host},isQushu:function(){return"bi.trenddata.cn"==window.location.host||"127.0.0.1:8080"==window.location.host}}}]),services.factory("tmp",[function(){return{data:{}}}]),services.factory("chartOptions",function(){return{}}),services.factory("userConfig",["tools","$rootScope",function(e,t){return{data:null,initUserConfig:function(e){this.data=e&&e.userConfig?e.userConfig:{},window.localStorage.setItem("userConfig",JSON.stringify(this.data))},getUserConfig:function(){return this.data=this.data||JSON.parse(window.localStorage.getItem("userConfig")),this.data},updateUserConfig:function(t){var n=this;n.data&&e.get({url:"/Ibm-Client/updateUserConfig.htm",data:{configInfo:JSON.stringify(n.data)},succ:function(e){e.success&&(t&&t(),window.localStorage.setItem("userConfig",JSON.stringify(n.data)))}})}}}]);